!function(e){e.fn.imageUploader=function(t){let i,n={preloaded:[],imagesInputName:"images",preloadedInputName:"preloaded",label:"Drag & Drop files here or click to browse",extensions:[".jpg",".jpeg",".png",".gif",".svg"],mimes:["image/jpeg","image/png","image/gif","image/svg+xml"],maxSize:void 0,maxFiles:void 0},a=this,s=new DataTransfer;a.settings={},a.init=function(){a.settings=e.extend(a.settings,n,t),a.each(function(t,i){let n=o();if(e(i).append(n),n.on("dragover",r.bind(n)),n.on("dragleave",r.bind(n)),n.on("drop",p.bind(n)),a.settings.preloaded.length){n.addClass("has-files");let e=n.find(".uploaded");for(let t=0;t<a.settings.preloaded.length;t++)e.append(l(a.settings.preloaded[t].src,a.settings.preloaded[t].id,!0))}})};let o=function(){let t=e("<div>",{class:"image-uploader"});i=e("<input>",{type:"file",id:a.settings.imagesInputName,name:a.settings.imagesInputName+"[]",accept:a.settings.extensions.join(","),multiple:""}).appendTo(t);e("<div>",{class:"uploaded"}).appendTo(t);let n=e("<div>",{class:"upload-text"}).appendTo(t);e("<i>",{class:"iui-cloud-upload"}).appendTo(n),e("<span>",{text:a.settings.label}).appendTo(n);return t.on("click",function(e){d(e),i.trigger("click")}),i.on("click",function(e){e.stopPropagation()}),i.on("change",p.bind(t)),t},d=function(e){e.preventDefault(),e.stopPropagation()},l=function(t,n,o){let l=e("<div>",{class:"uploaded-image"}),r=(e("<img>",{src:t}).appendTo(l),e("<button>",{class:"delete-image",fileid:n}).appendTo(l));e("<i>",{class:"lni lni-trash",title:"Remover imagem"}).appendTo(r);if(o){l.attr("data-preloaded",!0);e("<input>",{type:"hidden",name:a.settings.preloadedInputName+"[]",value:n}).appendTo(l)}else l.attr("data-index",n);return l.on("click",function(e){d(e)}),r.on("click",function(t){if(confirm("Tem certeza que quer remover a imagem? A ação não poderá ser desfeita!")){d(t);let o=l.parent();if(!0===l.data("preloaded"))a.settings.preloaded=a.settings.preloaded.filter(function(e){return e.id!==n});else{let t=parseInt(l.data("index"));o.find(".uploaded-image[data-index]").each(function(i,n){i>t&&e(n).attr("data-index",i-1)}),s.items.remove(t),i.prop("files",s.files)}l.remove(),o.children().length||o.parent().removeClass("has-files"),kill_image(n)}}),l},r=function(t){d(t),"dragover"===t.type?e(this).addClass("drag-over"):e(this).removeClass("drag-over")},p=function(t){d(t);let n=e(this),o=Array.from(t.target.files||t.originalEvent.dataTransfer.files),l=[];e(o).each(function(e,t){a.settings.extensions&&!g(t)||a.settings.mimes&&!m(t)||a.settings.maxSize&&!u(t)||a.settings.maxFiles&&!c(l.length,t)||l.push(t)}),l.length?(n.removeClass("drag-over"),f(n,l)):i.prop("files",s.files),watchadd()},g=function(e){return!(a.settings.extensions.indexOf(e.name.replace(new RegExp("^.*\\."),"."))<0)||(alert(`O arquivo "${e.name}" não possui uma extensão permitida: "${a.settings.extensions.join('", "')}"`),!1)},m=function(e){return!(a.settings.mimes.indexOf(e.type)<0)||(alert(`O arquivo "${e.name}" não é permitido: "${a.settings.mimes.join('", "')}"`),!1)},u=function(e){return!(e.size>a.settings.maxSize)||(alert(`O arquivo "${e.name}" excede o tamanho máximo ${a.settings.maxSize/1024/1024}Mb`),!1)},c=function(e,t){return!(e+s.items.length+a.settings.preloaded.length>=a.settings.maxFiles)||(alert(`O arquivo "${t.name}" não pode ser adicionado pois ultrapassou o limite de ${a.settings.maxFiles} arquivos`),!1)},f=function(t,i){t.addClass("has-files");let n=t.find(".uploaded"),a=t.find('input[type="file"]');e(i).each(function(e,t){s.items.add(t),n.append(l(URL.createObjectURL(t),s.items.length-1),!1)}),a.prop("files",s.files)};return this.init(),this}}(jQuery);